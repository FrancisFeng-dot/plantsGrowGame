{"version":3,"sources":["maskprefab.js"],"names":["cc","Class","extends","Component","properties","maskimg","Sprite","maskname","RichText","maskvalue","btnfinishNode","default","type","Node","init","data","that","mask","find","parentnode","loader","load","image","err","texture","spriteFrame","SpriteFrame","string","name","str","frequency","integral","prize_status","addbtnevent","loadRes","getChildByName","getComponent","id","clickbtn","event","customEventData","Animation","play","scheduleOnce","urltype","share","active","setTimeout","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","JSON","parse","responseText","code","copydata","open","url","setRequestHeader","send","window","location","href","urlstr","invitereward","e","Event","EventCustom","setUserData","energy","water","dispatchEvent","layermsg","Label","eventname","clickEventHandler","EventHandler","target","node","component","handler","button","Button","clickEvents","push","start"],"mappings":"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","file":"maskprefab.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        maskimg: cc.Sprite,\r\n        maskname: cc.RichText,\r\n        maskvalue: cc.RichText,\r\n\r\n        btnfinishNode: {\r\n            default: null,\r\n            type: cc.Node\r\n        }\r\n    },\r\n\r\n    init:function(data){\r\n        var that = this;\r\n        that.mask = cc.find(\"Canvas/masklayer\");\r\n        that.parentnode = cc.find(\"Canvas/taskCollar\");\r\n\r\n        cc.loader.load(data.image, function (err, texture) {\r\n            that.maskimg.spriteFrame = new cc.SpriteFrame(texture);\r\n        });\r\n        that.maskname.string = '<b>'+ data.name +'</b>';\r\n        var str = data.frequency>1?' 每天限'+ data.frequency +'次':'';\r\n        \r\n        that.maskvalue.string = '<color=#9D5B34>水滴  </color><color=#E04500>+'+ data.integral + str +'</color>';\r\n\r\n        if(data.prize_status==0){\r\n            that.addbtnevent(\"clickbtn\",data);\r\n            //未完成\r\n        }else if(data.prize_status==1){\r\n            cc.loader.loadRes(\"maskreceive\", cc.SpriteFrame, function (err, spriteFrame) {\r\n                that.btnfinishNode.getChildByName('Background').getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n            });\r\n            that.addbtnevent(\"invitereward\",data.id);\r\n            //未领取\r\n        }else{\r\n            cc.loader.loadRes(\"taskreceive\", cc.SpriteFrame, function (err, spriteFrame) {\r\n                that.btnfinishNode.getChildByName('Background').getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n            });\r\n            //已领取\r\n        }\r\n    },\r\n\r\n    clickbtn (event, customEventData) {\r\n        var that = this;\r\n        that.btnfinishNode.getComponent(cc.Animation).play('scale109');\r\n        that.scheduleOnce(function() {\r\n            if(customEventData.urltype==1){\r\n                that.share = cc.find(\"Canvas/sharetofriend\");\r\n                that.mask.active = true;\r\n                that.share.active = true;\r\n                that.parentnode.active = false;\r\n                setTimeout(function() {\r\n                    that.mask.active = false;\r\n                    that.share.active = false;\r\n                }, 4000);\r\n    //分享\r\n            }else if(customEventData.urltype==2){\r\n                var xhr = new XMLHttpRequest();\r\n                xhr.onreadystatechange = function(){\r\n                    if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                        var response = JSON.parse(xhr.responseText);\r\n                        if(response.code==1){\r\n                            var copydata = response.data;\r\n                            cc.loader.loadRes(\"maskreceive\", cc.SpriteFrame, function (err, spriteFrame) {\r\n                                that.btnfinishNode.getChildByName('Background').getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n                            });\r\n                            that.addbtnevent(\"invitereward\",customEventData.id);\r\n                        }\r\n                    }\r\n                };\r\n                xhr.open('POST',customEventData.url,true);\r\n                xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=UTF-8\");\r\n                xhr.send('gtid='+customEventData.id);\r\n    //接口\r\n            }else{\r\n                var xhr = new XMLHttpRequest();\r\n                xhr.onreadystatechange = function(){\r\n                    if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                        var response = JSON.parse(xhr.responseText);\r\n                        if(response.code==1){\r\n                            window.location.href = customEventData.url;\r\n                        }\r\n                    }\r\n                };\r\n                var urlstr = location.href=='http://localhost:7456/'?'http://game.com':'https://h5xyx.jinlingkeji.cn';\r\n                xhr.open('POST',urlstr+'/api/v11/game/updateTaskSpeed',true);\r\n                xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=UTF-8\");\r\n                xhr.send('gtid='+customEventData.id);\r\n                //链接\r\n            }\r\n        }, 0.4);\r\n    },\r\n\r\n    invitereward (event, customEventData) {\r\n        var that = this;\r\n        that.btnfinishNode.getComponent(cc.Animation).play('scale109');\r\n        that.scheduleOnce(function() {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.onreadystatechange = function(){\r\n                if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                    var response = JSON.parse(xhr.responseText);\r\n                    if(response.code==1){\r\n                        var copydata = response.data;\r\n                        that.parentnode.active = false;\r\n                        var e = new cc.Event.EventCustom('hidefirstin', true);\r\n                        e.setUserData({ energy:  copydata.water});\r\n                        that.btnfinishNode.dispatchEvent(e);\r\n                    }else{\r\n                        that.layermsg = cc.find(\"Canvas/layertip\");\r\n                        that.layermsg.getChildByName(\"layermsg\").getComponent(cc.Label).string = '水壶里的水满了，先去浇水哦';\r\n                        that.layermsg.active = true;\r\n                        setTimeout(function() {\r\n                            that.layermsg.active = false;\r\n                        }, 3000);\r\n                    }\r\n                }\r\n            };\r\n            var urlstr = location.href=='http://localhost:7456/'?'http://game.com':'https://h5xyx.jinlingkeji.cn';\r\n            xhr.open('POST',urlstr+'/api/v11/game/getIntegral',true);\r\n            xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=UTF-8\");\r\n            xhr.send('gtid='+customEventData);\r\n        }, 0.4);\r\n    },\r\n\r\n    addbtnevent(eventname,data){\r\n        var clickEventHandler = new cc.Component.EventHandler();\r\n        clickEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\r\n        clickEventHandler.component = \"maskprefab\";//这个是代码文件名\r\n        clickEventHandler.handler = eventname;\r\n        clickEventHandler.customEventData = data;\r\n\r\n        var button = this.btnfinishNode.getComponent(cc.Button);\r\n        button.clickEvents = [];\r\n        button.clickEvents.push(clickEventHandler);\r\n    },\r\n\r\n    start () {\r\n\r\n    }\r\n});\r\n"]}